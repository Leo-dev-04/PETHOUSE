<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Sincronizaci√≥n - PETHOUSE</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid;
        }
        .status.success {
            background: #f0fdf4;
            border-color: #22c55e;
            color: #15803d;
        }
        .status.error {
            background: #fef2f2;
            border-color: #ef4444;
            color: #dc2626;
        }
        .status.info {
            background: #f0f9ff;
            border-color: #3b82f6;
            color: #1d4ed8;
        }
        .links {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #e5e7eb;
        }
        .links a {
            display: inline-block;
            margin: 10px;
            padding: 10px 20px;
            background: #10b981;
            color: white;
            text-decoration: none;
            border-radius: 6px;
        }
        .links a:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de Sincronizaci√≥n PETHOUSE</h1>
        <p>Esta p√°gina te permite probar la sincronizaci√≥n entre el formulario de registro y el panel de administraci√≥n.</p>
        
        <div id="status"></div>
        
        <h3>üîß Acciones de Prueba:</h3>
        
        <button class="test-button" onclick="crearSolicitudPrueba()">
            ‚ûï Crear Solicitud de Prueba
        </button>
        
        <button class="test-button" onclick="verificarSolicitudes()">
            üìã Verificar Solicitudes
        </button>
        
        <button class="test-button" onclick="limpiarDatos()">
            üóëÔ∏è Limpiar Todas las Solicitudes
        </button>
        
        <button class="test-button" onclick="simularEnvio()">
            üì§ Simular Env√≠o de Formulario
        </button>
        
        <div class="links">
            <h3>üîó Enlaces √ötiles:</h3>
            <a href="registro-organizacion.html" target="_blank">üìù Formulario de Registro</a>
            <a href="admin-organizaciones.html" target="_blank">‚öôÔ∏è Panel de Administraci√≥n</a>
        </div>
    </div>

    <!-- Scripts necesarios -->
    <script src="../organizaciones-api.js"></script>
    
    <script>
        function mostrarStatus(mensaje, tipo = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${tipo}">${mensaje}</div>`;
        }

        function crearSolicitudPrueba() {
            const solicitudPrueba = {
                id: 'TEST-' + Date.now(),
                numeroSolicitud: 'TEST-' + Date.now(),
                fechaSolicitud: new Date().toISOString(),
                estado: 'pendiente',
                nombreOrganizacion: 'Organizaci√≥n de Prueba ' + new Date().toLocaleTimeString(),
                tipoOrganizacion: 'refugio',
                descripcion: 'Esta es una organizaci√≥n creada para testing de sincronizaci√≥n',
                a√±oFundacion: 2024,
                numeroMascotas: Math.floor(Math.random() * 50) + 1,
                personaContacto: 'Usuario Test',
                emailContacto: 'test@ejemplo.com',
                telefonoContacto: '555-0123',
                direccion: 'Direcci√≥n de prueba 123',
                origen: 'test_page'
            };

            // Guardar en localStorage
            const solicitudes = JSON.parse(localStorage.getItem('pethouse_solicitudes_organizaciones') || '[]');
            solicitudes.push(solicitudPrueba);
            localStorage.setItem('pethouse_solicitudes_organizaciones', JSON.stringify(solicitudes));

            // Disparar evento
            const evento = new CustomEvent('solicitudEnviada', {
                detail: {
                    solicitud: solicitudPrueba,
                    timestamp: new Date().toISOString(),
                    totalSolicitudes: solicitudes.length
                }
            });
            window.dispatchEvent(evento);

            mostrarStatus(`‚úÖ Solicitud creada: "${solicitudPrueba.nombreOrganizacion}" (Total: ${solicitudes.length})`, 'success');
        }

        function verificarSolicitudes() {
            const solicitudes = JSON.parse(localStorage.getItem('pethouse_solicitudes_organizaciones') || '[]');
            
            const stats = {
                total: solicitudes.length,
                pendientes: solicitudes.filter(s => s.estado === 'pendiente').length,
                aprobadas: solicitudes.filter(s => s.estado === 'aprobada').length,
                rechazadas: solicitudes.filter(s => s.estado === 'rechazada').length
            };

            mostrarStatus(`
                üìä <strong>Estado de Solicitudes:</strong><br>
                Total: ${stats.total} | 
                Pendientes: ${stats.pendientes} | 
                Aprobadas: ${stats.aprobadas} | 
                Rechazadas: ${stats.rechazadas}
            `, 'info');
        }

        function limpiarDatos() {
            if (confirm('¬øEst√°s seguro de que quieres eliminar todas las solicitudes?')) {
                localStorage.removeItem('pethouse_solicitudes_organizaciones');
                mostrarStatus('üóëÔ∏è Todos los datos han sido eliminados', 'info');
            }
        }

        async function simularEnvio() {
            const datosSimulados = {
                nombreOrganizacion: 'Refugio Simulado ' + new Date().toLocaleTimeString(),
                tipoOrganizacion: 'refugio',
                descripcion: 'Refugio simulado para testing de sincronizaci√≥n entre formulario y panel de admin',
                a√±oFundacion: '2023',
                numeroMascotas: '25',
                personaContacto: 'Contacto Simulado',
                cargoContacto: 'Director',
                emailContacto: 'simulado@test.com',
                telefonoContacto: '+52 55 1234-5678',
                direccion: 'Direcci√≥n simulada 456',
                sitioWeb: 'https://www.test.com',
                registroOficial: 'RFC: TEST123',
                aceptarTerminos: true,
                aceptarPoliticas: true,
                aceptarComunicaciones: true
            };

            try {
                mostrarStatus('üì§ Simulando env√≠o de formulario...', 'info');
                
                if (typeof window.enviarSolicitudOrganizacion === 'function') {
                    const resultado = await window.enviarSolicitudOrganizacion(datosSimulados);
                    
                    if (resultado.success) {
                        mostrarStatus(`‚úÖ Simulaci√≥n exitosa: ${resultado.data.mensaje}<br>
                                     N√∫mero: ${resultado.data.numeroSolicitud}`, 'success');
                    } else {
                        mostrarStatus(`‚ùå Error en simulaci√≥n: ${resultado.error}`, 'error');
                    }
                } else {
                    mostrarStatus('‚ùå Funci√≥n enviarSolicitudOrganizacion no disponible', 'error');
                }
            } catch (error) {
                mostrarStatus(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Event listeners
        window.addEventListener('solicitudEnviada', (event) => {
            console.log('üîî Evento detectado en p√°gina de test:', event.detail);
        });

        // Verificar estado inicial
        document.addEventListener('DOMContentLoaded', () => {
            mostrarStatus('üöÄ Sistema de testing iniciado. Usa los botones para probar la funcionalidad.', 'info');
            verificarSolicitudes();
        });
    </script>
</body>
</html>